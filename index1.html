<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV 지원 영어 문장 학습</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        #sentence-display {
            font-size: 24px;
            margin-bottom: 20px;
            min-height: 100px;
        }
        #translation {
            font-style: italic;
            color: #666;
            margin-bottom: 20px;
        }
        #user-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
        }
        button {
            display: inline-block;
            width: 48%;
            padding: 10px;
            margin: 1%;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #submit-btn { background-color: #4CAF50; }
        #show-answer-btn { background-color: #f44336; }
        #next-btn { background-color: #008CBA; display: none; }
        #hint { color: #ff9800; margin-top: 10px; }
        #progress {
            margin-top: 20px;
            background-color: #ddd;
            height: 30px;
            border-radius: 5px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.5s;
        }
        #file-input {
            display: none;
        }
        #file-label {
            display: inline-block;
            padding: 10px;
            background-color: #008CBA;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        #csv-info {
            margin-top: 20px;
            padding: 10px;
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV 지원 영어 문장 학습</h1>
        
        <div id="csv-info">
            <h2>CSV 파일 업로드</h2>
            <p>자신만의 문장을 학습하려면 CSV 파일을 업로드하세요.</p>
            <p>CSV 형식: "영어 문장","한국어 번역"</p>
            <a href="#" id="sample-csv">샘플 CSV 다운로드</a>
            <br><br>
            <label for="file-input" id="file-label">CSV 파일 선택</label>
            <input type="file" id="file-input" accept=".csv">
        </div>

        <div id="sentence-display"></div>
        <div id="translation"></div>
        <input type="text" id="user-input" placeholder="문장을 입력하세요...">
        <button id="submit-btn">제출</button>
        <button id="show-answer-btn">정답 보기</button>
        <button id="next-btn">다음 단계</button>
        <div id="hint"></div>
        <div id="progress">
            <div id="progress-bar"></div>
        </div>
    </div>

    <script>
        let sentences = [
            {
                english: "The greatest glory in living lies not in never falling, but in rising every time we fall.",
                korean: "삶의 가장 큰 영광은 넘어지지 않는 것에 있지 않고, 매번 일어서는 데에 있다."
            },
            {
                english: "The way to get started is to quit talking and begin doing.",
                korean: "시작하는 방법은 말하기를 그만두고 행동을 시작하는 것이다."
            }
        ];

        let currentSentenceIndex = 0;
        let currentStage = 1;
        const totalStages = 3;
        let attempts = 0;

        const sentenceDisplay = document.getElementById('sentence-display');
        const translation = document.getElementById('translation');
        const userInput = document.getElementById('user-input');
        const submitBtn = document.getElementById('submit-btn');
        const showAnswerBtn = document.getElementById('show-answer-btn');
        const nextBtn = document.getElementById('next-btn');
        const hintElement = document.getElementById('hint');
        const progressBar = document.getElementById('progress-bar');
        const fileInput = document.getElementById('file-input');
        const sampleCsvLink = document.getElementById('sample-csv');

        function displaySentence() {
            const sentence = sentences[currentSentenceIndex].english;
            const words = sentence.split(' ');
            const displayWords = words.slice(0, Math.ceil(words.length * (currentStage / totalStages)));
            sentenceDisplay.textContent = displayWords.join(' ') + ' ...';
            translation.textContent = sentences[currentSentenceIndex].korean;
            hintElement.textContent = '';
        }

        function checkAnswer() {
            const userSentence = userInput.value.trim();
            const correctSentence = sentences[currentSentenceIndex].english;
            
            if (userSentence.toLowerCase() === correctSentence.toLowerCase()) {
                alert('정답입니다!');
                submitBtn.style.display = 'none';
                showAnswerBtn.style.display = 'none';
                nextBtn.style.display = 'inline-block';
                updateProgress();
            } else {
                attempts++;
                const errors = findErrors(userSentence, correctSentence);
                if (errors.length > 0) {
                    hintElement.textContent = `힌트: ${errors.join(', ')}`;
                } else {
                    hintElement.textContent = '철자와 구두점을 다시 확인해보세요.';
                }
                if (attempts >= 3) {
                    showAnswer();
                }
            }
        }

        function findErrors(userSentence, correctSentence) {
            const userWords = userSentence.toLowerCase().split(' ');
            const correctWords = correctSentence.toLowerCase().split(' ');
            const errors = [];

            for (let i = 0; i < Math.min(userWords.length, correctWords.length); i++) {
                if (userWords[i] !== correctWords[i]) {
                    errors.push(`'${correctWords[i]}' 단어를 확인하세요`);
                }
            }

            if (userWords.length < correctWords.length) {
                errors.push('문장이 완성되지 않았습니다');
            } else if (userWords.length > correctWords.length) {
                errors.push('불필요한 단어가 있습니다');
            }

            return errors;
        }

        function showAnswer() {
            userInput.value = sentences[currentSentenceIndex].english;
            hintElement.textContent = '정답을 확인하세요. "다음 단계" 버튼을 눌러 계속하세요.';
            submitBtn.style.display = 'none';
            showAnswerBtn.style.display = 'none';
            nextBtn.style.display = 'inline-block';
        }

        function nextStage() {
            currentStage++;
            attempts = 0;
            if (currentStage > totalStages) {
                currentStage = 1;
                currentSentenceIndex++;
                if (currentSentenceIndex >= sentences.length) {
                    alert('모든 문장을 완료했습니다! 처음부터 다시 시작합니다.');
                    currentSentenceIndex = 0;
                }
            }
            userInput.value = '';
            submitBtn.style.display = 'inline-block';
            showAnswerBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';
            displaySentence();
        }

        function updateProgress() {
            const progress = ((currentSentenceIndex * totalStages + currentStage) / (sentences.length * totalStages)) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                sentences = parseCSV(csv);
                currentSentenceIndex = 0;
                currentStage = 1;
                displaySentence();
                updateProgress();
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            return lines.map(line => {
                const [english, korean] = line.split(',').map(item => item.trim().replace(/^"|"$/g, ''));
                return { english, korean };
            }).filter(item => item.english && item.korean);
        }

        function downloadSampleCSV() {
            const csvContent = `"The greatest glory in living lies not in never falling, but in rising every time we fall.","삶의 가장 큰 영광은 넘어지지 않는 것에 있지 않고, 매번 일어서는 데에 있다."
"The way to get started is to quit talking and begin doing.","시작하는 방법은 말하기를 그만두고 행동을 시작하는 것이다."`;
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "sample_sentences.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        submitBtn.addEventListener('click', checkAnswer);
        showAnswerBtn.addEventListener('click', showAnswer);
        nextBtn.addEventListener('click', nextStage);
        fileInput.addEventListener('change', handleFileUpload);
        sampleCsvLink.addEventListener('click', downloadSampleCSV);

        displaySentence();
        updateProgress();
    </script>
</body>
</html>